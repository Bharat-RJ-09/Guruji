<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Command Center | NextEdu</title>
    <link rel="stylesheet" href="assets/css/dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background: #050505; }
        .sidebar { border-right: 1px solid #222; background: #0a0a0a; }
        .stat-card { background: #111; border: 1px solid #333; }
        .tab-nav { display: flex; gap: 20px; margin-bottom: 30px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .tab-btn { background: none; border: none; color: #777; font-size: 1.1rem; cursor: pointer; padding: 10px; transition: 0.3s; }
        .tab-btn.active { color: #00f0ff; border-bottom: 2px solid #00f0ff; }
        .section { display: none; animation: fadeIn 0.5s; }
        .section.active { display: block; }
        .admin-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .admin-table th { text-align: left; color: #777; padding: 15px; border-bottom: 1px solid #333; }
        .admin-table td { padding: 15px; border-bottom: 1px solid #222; color: #ddd; }
        .admin-inp { background: #111; border: 1px solid #333; color: #fff; padding: 10px; width: 100px; text-align: center; }
    </style>
</head>
<body>

    <aside class="sidebar">
        <div class="brand" style="color:#fff;"><i class="fa-solid fa-shield-halved"></i> Admin<span>Panel</span></div>
        <a onclick="logoutAdmin()" class="nav-item" style="color:#ff4444; cursor:pointer; margin-top:auto;">Logout</a>
    </aside>

    <main class="main-content">
        <header class="header">
            <h1 style="color:#fff;">System Overview</h1>
            <div class="user-profile"><span style="color:#0f0;">‚óè Online</span></div>
        </header>

        <div class="tab-nav">
            <button class="tab-btn active" onclick="switchTab('overview')">Overview</button>
            <button class="tab-btn" onclick="switchTab('users')">User Management</button>
            <button class="tab-btn" onclick="switchTab('pricing')">Pricing</button>
            <button class="tab-btn" onclick="switchTab('files')">Upload Questions</button>
        </div>

        <div id="overview" class="section active">
            <div class="stats-grid">
                <div class="stat-card"><h3 id="st-users">0</h3> <p>Total Users</p></div>
                <div class="stat-card" style="border-color:#bd00ff;"><h3 id="st-prime" style="color:#bd00ff;">0</h3> <p>Prime Members</p></div>
                <div class="stat-card" style="border-color:#00ff88;"><h3 id="st-rev" style="color:#00ff88;">‚Çπ0</h3> <p>Total Revenue</p></div>
            </div>
        </div>

        <div id="users" class="section">
            <input type="text" placeholder="Search User..." style="padding:10px; width:100%; background:#111; border:1px solid #333; color:#fff;">
            <table class="admin-table">
                <thead><tr><th>ID</th><th>Name</th><th>Plan</th><th>Balance</th><th>Action</th></tr></thead>
                <tbody id="user-list"></tbody>
            </table>
        </div>

        <div id="pricing" class="section">
            <h3 style="color:#fff;">Subscription Pricing</h3>
            <div style="display:flex; gap:30px; margin-top:20px;">
                <div class="stat-card">
                    <p>Standard Plan (‚Çπ)</p>
                    <input type="number" id="price-standard" class="admin-inp">
                    <button onclick="savePrice('standard')" style="margin-left:10px; padding:10px; background:#00f0ff; border:none; cursor:pointer;">Save</button>
                </div>
                <div class="stat-card">
                    <p>Prime Plan (‚Çπ)</p>
                    <input type="number" id="price-prime" class="admin-inp">
                    <button onclick="savePrice('prime')" style="margin-left:10px; padding:10px; background:#bd00ff; border:none; cursor:pointer;">Save</button>
                </div>
            </div>
        </div>

        <div id="files" class="section"> 
            <div class="upload-box" style="border: 2px dashed #333; padding: 40px; border-radius: 20px; text-align: center; background: rgba(255,255,255,0.02);">
                <h2 style="color:#fff; margin-bottom:20px;">‚òÅÔ∏è Upload Question Bank (CSV)</h2>
                
                <select id="uploadExam" class="admin-inp" style="width: 200px; margin-bottom: 10px; text-align: left;">
                    <option value="general">üåç General Practice</option>
                    <option value="bstc">üè´ BSTC Exam</option>
                    <option value="ptet">üéì PTET Exam</option>
                    <option value="rpsc">üèõÔ∏è RPSC Exam</option>
                </select>

                <select id="uploadSubject" class="admin-inp" style="width: 200px; margin-bottom: 20px; text-align: left;">
                    <option value="english">üÖ∞Ô∏è English</option>
                    <option value="hindi">üïâÔ∏è Hindi</option>
                    <option value="gk">üïå GK</option>
                    <option value="reasoning">üß† Reasoning</option>
                    <option value="teaching_aptitude">üë®‚Äçüè´ Teaching Aptitude</option>
                    <option value="science">üî¨ Science</option>
                    <option value="maths">‚ûó Maths</option>
                </select>
                <br>
                <input type="file" id="csvFile" accept=".csv" style="color:#fff; margin-bottom: 20px;">
                <br>
                <button onclick="uploadQuestions()" style="background: linear-gradient(90deg, #00f0ff, #007bff); border: none; padding: 12px 30px; color: #000; font-weight: bold; border-radius: 50px; cursor: pointer;">
                    üöÄ Upload to Database
                </button>
                <p id="uploadStatus" style="margin-top: 15px; color: #aaa;"></p>
            </div>
        </div> 

    </main>

    <script>
        const API = "api/admin";

        window.onload = loadData;

        function switchTab(id) {
            document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            event.target.classList.add('active');
        }

        async function loadData() {
            try {
                const res = await fetch(`${API}/data.php`);
                const data = await res.json();
                
                // If not logged in, redirect
                if(data.status === 'error' && data.message === 'Unauthorized') {
                     window.location.href = 'admin-login.html';
                     return;
                }

                if(data.stats) {
                    document.getElementById('st-users').innerText = data.stats.total_users;
                    document.getElementById('st-prime').innerText = data.stats.prime_users;
                    document.getElementById('st-rev').innerText = "‚Çπ" + data.stats.revenue;
                }
                
                if(data.users) {
                    const userList = document.getElementById('user-list');
                    userList.innerHTML = "";
                    data.users.forEach(u => {
                        userList.innerHTML += `<tr>
                            <td>#${u.id}</td>
                            <td>${u.full_name}<br><small style="color:#555;">${u.email}</small></td>
                            <td><span style="color:${u.subscription_plan==='prime'?'#bd00ff':'#fff'}">${u.subscription_plan}</span></td>
                            <td>‚Çπ${u.balance}</td>
                            <td><button style="color:red; background:none; border:none; cursor:pointer;">Block</button></td>
                        </tr>`;
                    });
                }
            } catch(e) { console.error("Admin Load Error", e); }
        }

        async function uploadQuestions() {
            const file = document.getElementById('csvFile').files[0];
            const exam = document.getElementById('uploadExam').value;
            const subject = document.getElementById('uploadSubject').value;

            if (!file) return alert("Please select a CSV file!");

            const formData = new FormData();
            formData.append('csv_file', file);
            formData.append('exam', exam);
            formData.append('subject', subject);

            document.getElementById('uploadStatus').innerText = "Uploading... ‚è≥";

            try {
                const res = await fetch('api/admin/upload.php', { method: 'POST', body: formData });
                const data = await res.json();
                
                if (data.status === 'success') {
                    document.getElementById('uploadStatus').innerHTML = `<span style="color:#0f0">‚úÖ Success! Added ${data.count} questions.</span>`;
                } else {
                    document.getElementById('uploadStatus').innerText = "‚ùå " + data.message;
                }
            } catch (e) { 
                document.getElementById('uploadStatus').innerText = "‚ùå Upload Error";
                console.error(e);
            }
        }
        
        function logoutAdmin() {
             // In a real app, hit an API to destroy session
             window.location.href = 'admin-login.html';
        } 
    </script>
</body>
</html>